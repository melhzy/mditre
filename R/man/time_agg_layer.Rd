% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/layer2_temporal_focus.R
\name{time_agg_layer}
\alias{time_agg_layer}
\title{Time Aggregation Layer (with slopes)}
\usage{
time_agg_layer(
  num_rules,
  num_otus,
  num_time,
  num_time_centers,
  layer_name = "time_agg",
  ...
)
}
\arguments{
\item{num_rules}{Number of rule detectors}

\item{num_otus}{Number of OTUs}

\item{num_time}{Number of time points}

\item{num_time_centers}{Number of time window centers (unused, kept for compatibility)}

\item{layer_name}{Name for this layer instance (default: "time_agg")}

\item{...}{Additional arguments passed to base layer}
}
\value{
An R6 class representing a TimeAgg layer
}
\description{
Aggregate time-series along the time dimension, selecting contiguous time
windows important for prediction using sigmoid-based importance weights.
Computes both average abundance and average slope within the selected time window.
}
\details{
Architecture:
\itemize{
\item Input: (batch, num_rules, num_otus, time_points)
\item Output: list(abundance, slope), both (batch, num_rules, num_otus)
}

The layer learns to focus on specific time windows by parameterizing:
\itemize{
\item Window center (mu): Position of the time window
\item Window width (sigma): Width of the time window
\item Separate parameters for abundance and slope computation
}

Uses soft time window selection via unitboxcar function for differentiability.
}
\examples{
\dontrun{
library(torch)

# Create layer
layer <- time_agg_layer(
  num_rules = 5,
  num_otus = 20,
  num_time = 10,
  num_time_centers = 1
)

# Forward pass
x <- torch_randn(32, 5, 20, 10)  # batch=32, rules=5, otus=20, time=10
result <- layer(x)
print(result$abundance$shape)  # [32, 5, 20]
print(result$slope$shape)      # [32, 5, 20]

# With time mask
mask <- torch_ones(32, 10)
mask[, 1:3] <- 0  # Mask first 3 time points
result <- layer(x, mask = mask)
}

}
