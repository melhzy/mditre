% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/layer1_phylogenetic_focus.R
\name{spatial_agg_dynamic_layer}
\alias{spatial_agg_dynamic_layer}
\title{Spatial Aggregation Layer (Dynamic)}
\usage{
spatial_agg_dynamic_layer(
  num_rules,
  num_otu_centers,
  otu_embeddings,
  emb_dim,
  num_otus
)
}
\arguments{
\item{num_rules}{Integer; number of rule detectors}

\item{num_otu_centers}{Integer; number of OTU centers to learn}

\item{otu_embeddings}{Numeric matrix; OTU embedding matrix (num_otus x emb_dim)}

\item{emb_dim}{Integer; embedding dimension}

\item{num_otus}{Integer; total number of OTUs}

\item{x}{Input tensor (batch, num_otus, time_points)}

\item{k}{Temperature parameter for sigmoid sharpness (default: 1)}

\item{init_args}{Named list with 'kappa_init' and 'eta_init'}
}
\value{
Aggregated tensor (batch, num_rules, num_otu_centers, time_points)
}
\description{
Dynamic spatial aggregation based on learned OTU embeddings.
Instead of using a fixed distance matrix, this layer learns OTU center
embeddings and computes distances dynamically in embedding space.
This provides more flexibility for the model to discover phylogenetic
patterns relevant to the prediction task.

Initialize dynamic spatial aggregation layer

Forward pass: aggregate OTUs based on learned embedding distances

Initialize layer parameters
}
\section{Architecture}{

\describe{
\item{Input}{(batch, num_otus, time_points)}
\item{Output}{(batch, num_rules, num_otu_centers, time_points)}
}
}

\examples{
\dontrun{
library(torch)

# Create example OTU embeddings
otu_embeddings <- matrix(rnorm(20 * 10), nrow = 20, ncol = 10)

# Initialize layer
layer <- spatial_agg_dynamic_layer(
  num_rules = 5,
  num_otu_centers = 3,
  otu_embeddings = otu_embeddings,
  emb_dim = 10,
  num_otus = 20
)

# Forward pass
x <- torch_randn(32, 20, 10)  # batch=32, otus=20, time=10
output <- layer(x)
print(output$shape)  # [32, 5, 3, 10]
}
}
