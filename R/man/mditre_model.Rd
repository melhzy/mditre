% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/models.R
\name{mditre_model}
\alias{mditre_model}
\title{MDITRE Model (Full - with slopes)}
\usage{
mditre_model(
  num_rules,
  num_otus,
  num_otu_centers,
  num_time,
  num_time_centers,
  dist,
  emb_dim
)
}
\arguments{
\item{num_rules}{Number of rules to learn}

\item{num_otus}{Number of OTUs in the dataset}

\item{num_otu_centers}{Number of phylogenetic centers (for dynamic aggregation)}

\item{num_time}{Number of time points}

\item{num_time_centers}{Number of time window centers (kept for compatibility)}

\item{dist}{Phylogenetic distance matrix or OTU embeddings}

\item{emb_dim}{Embedding dimension for dynamic spatial aggregation}
}
\value{
An R6 class representing the complete MDITRE model
}
\description{
Complete MDITRE model that assembles all 5 layers:
Layer 1 (Phylogenetic Focus) → Layer 2 (Temporal Focus) →
Layer 3 (Detectors) → Layer 4 (Rules) → Layer 5 (Classification)
}
\details{
\strong{Architecture}:
\itemize{
\item \strong{Layer 1}: SpatialAggDynamic - Phylogenetic focus using learned embeddings
\item \strong{Layer 2}: TimeAgg - Temporal focus with abundance and slope computation
\item \strong{Layer 3}: Threshold + Slope detectors - Gated responses for abundance and slopes
\item \strong{Layer 4}: Rules (2 instances) - Soft AND for abundance and slope rules
\item \strong{Layer 5}: DenseLayer - Classification with rule selection
}

\strong{Input}: (batch, num_otus, num_time) - OTU abundance time-series
\strong{Output}: (batch,) - Log odds for binary classification

\strong{Temperature Parameters}:
\itemize{
\item k_otu: Phylogenetic selection sharpness
\item k_time: Temporal window sharpness
\item k_thresh: Abundance threshold sharpness
\item k_slope: Slope threshold sharpness
\item k_alpha: Rule detector selection sharpness
\item k_beta: Final rule selection sharpness
}
}
\examples{
\dontrun{
library(torch)
library(ape)

# Setup
num_otus <- 50
num_time <- 10
tree <- rtree(num_otus)
phylo_dist <- cophenetic.phylo(tree)

# Create model
model <- mditre_model(
  num_rules = 5,
  num_otus = num_otus,
  num_otu_centers = 10,
  num_time = num_time,
  num_time_centers = 1,
  dist = phylo_dist,
  emb_dim = 3
)

# Forward pass
x <- torch_randn(32, num_otus, num_time)
predictions <- model(x)
print(predictions$shape)  # [32]

# Get probabilities
probs <- torch_sigmoid(predictions)
}

}
